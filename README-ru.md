[English](README.md) | **Русский**

# asm584

asm584 транслирует программы, написанные на языке ассемблера К584ВМ1, в двоичные файлы `.x584`. Полученные файлы могут быть открыты в [симуляторе X584](https://github.com/kodemeister/X584) для дальнейшего редактирования и отладки.

## Начало работы

Скачайте последнюю версию asm584 со страницы [Releases](https://github.com/kodemeister/asm584/releases) и распакуйте ее в любую папку.

Создайте текстовый файл с именем `max.asm` в той же папке, где находится распакованный исполняемый файл `asm584.exe`. Вставьте следующий код в файл:

```
/*
 * Автор: Иванов Иван
 * Описание: Вычисление максимального значения из двух 16-разрядных беззнаковых целых чисел
 */

    РОН0 := ШИНвх                       ; Ввод A
    РОН1 := ШИНвх                       ; Ввод B

    РР := РОН0 + П (П=0)                ; Копирование A в РР
    РР := РР - РОН1 - 1 + П (П=1)       ; Вычисление A - B
    РР := САЛ(РР + П) (П=0)             ; Проверка знакового разряда
    если !СДЛ1 то вывод_a иначе вывод_b

вывод_a:
    ШИНвых := РОН0                      ; Вывод A
    иди_на конец

вывод_b:
    ШИНвых := РОН1                      ; Вывод B
    иди_на конец

конец:
    останов НОП
```

Затем откройте командную строку и перейдите в папку, в которую вы распаковали исполняемый файл `asm584.exe` и сохранили файл `max.asm`. После этого запустите ассемблер, как показано ниже:

```bat
cd C:\путь\к\asm584-x.x.x.x
.\asm584.exe max.asm
```

Это должно создать выходной файл с именем `max.x584` в текущей папке. Теперь вы можете использовать [симулятор X584](https://github.com/kodemeister/X584), чтобы открыть `max.x584` и запустить скомпилированную программу.

## Запуск asm584

Чтобы скомпилировать исходный файл из командной строки, выполните следующую команду в папке, где находится `asm584.exe`:

```bat
.\asm584.exe <имя файла>
```

Например:

```bat
.\asm584.exe program.asm
```

asm584 скомпилирует входной файл `program.asm` и создаст выходной файл с тем же именем, но с расширением `.x584`, то есть `program.x584`.

Если вы хотите указать свое имя выходного файла, вы можете использовать опцию `-o` или `--output`, после которой идет нужное имя файла или путь:

```bat
.\asm584.exe program.asm -o myfolder\myfile.x584
```

Если вы хотите посмотреть, какую версию asm584 вы используете, вы можете воспользоваться опцией `-v` или `--version`:

```bat
.\asm584.exe --version
```

Чтобы получить дальнейшие инструкции по использованию, запустите asm584 с опцией `-h` или `--help`:

```bat
.\asm584.exe --help
```

## Язык ассемблера К584ВМ1

Программа, написанная на языке ассемблера К584ВМ1, состоит из последовательности операторов (statements). Каждый оператор содержит обязательную микроинструкцию и несколько необязательных полей, показанных ниже в квадратных скобках:

```
[метка:] [останов] микроинструкция [управляющий оператор] [; комментарий X584]
```

asm584 не накладывает ограничений на расстановку пробелов в операторах. Вы можете использовать любое количество пробелов для отступов, добавлять пробелы между полями или переносить любые поля на следующую строку для улучшения читаемости.

Язык ассемблера нечувствителен к регистру. Это означает, что ключевые слова, имена регистров, метки и другие элементы языка могут быть написаны в любом сочетании прописных и строчных букв. Например, `ШИНВХ`, `ШИНвх` и `шинвх` считаются одним и тем же ключевым словом.

Язык ассемблера также является двуязычным. Вы можете писать код как на русском, так и на английском языке. Например, вы можете использовать английские ключевые слова, такие как `WR`, `ALUCIN`, `if` и `goto` вместо их русских аналогов `РР`, `П`, `если` и `иди_на`. Вы даже можете смешивать слова из разных языков, хотя это не рекомендуется, так как может снизить читаемость кода. Для получения дополнительной информации об англоязычном синтаксисе см. [английскую документацию](README.md).

### Микроинструкции

asm584 поддерживает полный набор микроинструкций К584ВМ1, представленный в следующей таблице:

| Код           | Мнемоника                                   |
| ------------- | ------------------------------------------- |
| `OP   00 РОН` | `РОН := РОН н РР`                           |
| `OP   01 РОН` | `РР := РОН н РР`                            |
| `OP   11 000` | `ШИНвых := ШИНвх н РР`                      |
| `OP   11 001` | `РР := ШИНвх н РР`                          |
| `OP   11 011` | `РР := ШИНвх н РРР`                         |
| `OP   11 100` | `РРР := ШИНвх н РР`                         |
| `OP   11 110` | `РРР := ШИНвх н РРР`                        |
| `OP   11 111` | `ШИНвых := ШИНвх н РРР`                     |
| `0011 10 РОН` | `РРР := РОН + РР + П`                       |
| `0100 10 РОН` | `РР := РОН + ШИНвх + П`                     |
| `0101 10 РОН` | `РРР := РОН + ШИНвх + П`                    |
| `0111 10 РОН` | `РОН := РОН + ШИНвх + П`                    |
| `1100 10 РОН` | `РР := РОН + РРР + П`                       |
| `1101 10 РОН` | `РРР := РОН + РРР + П`                      |
| `1110 10 РОН` | `РОН := РРР + П`                            |
| `0011 11 010` | `РРР := РР + ШИНвх + П`                     |
| `0111 11 010` | `ШИНвых := РР + ШИНвх + П`                  |
| `1100 11 010` | `РР := РРР + ШИНвх + П`                     |
| `1101 11 010` | `РРР := РРР + ШИНвх + П`                    |
| `1110 11 010` | `ШИНвых := РРР + П`                         |
| `1111 10 РОН` | `РОН := ШИНвх`                              |
| `0000 10 РОН` | `ШИНвых := РОН`                             |
| `0001 10 РОН` | `РРР := РОН`                                |
| `0110 10 000` | `РР := ШИНвх`                               |
| `0001 11 010` | `РРР := ШИНвх`                              |
| `1111 11 010` | `ШИНвых := ШИНвх`                           |
| `1000 11 010` | `(РР, РРР) := СЦЛ(РР - ШИНвх - 1 + П, РРР)` |
| `1001 11 010` | `(РР, РРР) := СЦЛ(РР + ШИНвх + П, РРР)`     |
| `1000 10 РОН` | `(РР, РРР) := СЦЛ(РР - РОН - 1 + П, РРР)`   |
| `1001 10 РОН` | `(РР, РРР) := СЦЛ(РР + РОН + П, РРР)`       |
| `1010 10 000` | `(РР, РРР) := САП(РР + П, РРР)`             |
| `0010 11 010` | `(РР, РРР) := САП(РР - ШИНвх - 1 + П, РРР)` |
| `1011 11 010` | `(РР, РРР) := САП(РР + ШИНвх + П, РРР)`     |
| `0010 10 РОН` | `(РР, РРР) := САП(РР - РОН - 1 + П, РРР)`   |
| `1011 10 РОН` | `(РР, РРР) := САП(РР + РОН + П, РРР)`       |
| `0000 11 101` | `РР := САП(РР + П)`                         |
| `0001 11 101` | `РР := СЦП(РР + П)`                         |
| `0010 11 101` | `РР := САЛ(РР + П)`                         |
| `0011 11 101` | `РР := СЦЛ(РР + П)`                         |
| `1000 11 101` | `РР := СЛП(РР + П)`                         |
| `1010 11 101` | `РР := СЛЛ(РР + П)`                         |
| `0101 11 101` | `(РР, РРР) := СЦП(РР + П, РРР)`             |
| `0110 11 101` | `(РР, РРР) := САЛ(РР + П, РРР)`             |
| `0111 11 101` | `(РР, РРР) := СЦЛ(РР + П, РРР)`             |
| `1100 11 101` | `(РР, РРР) := СЛП(РР + П, РРР)`             |
| `1110 11 101` | `(РР, РРР) := СЛЛ(РР + П, РРР)`             |

asm584 также предоставляет специальную микроинструкцию `НОП` или `<ПУСТО>` с недокументированным кодом `0100 11 010`. Эта микроинструкция ничего не делает в X584.

Для микроинструкций #1–#8 доступны следующие операции АЛУ:

| Поле OP | Операция          |
| ------- | ----------------- |
| `0000`  | `!П`              |
| `0001`  | `B - A - 1 + П`   |
| `0010`  | `A - B - 1 + П`   |
| `0011`  | `A + B + П`       |
| `0100`  | `B + П`           |
| `0101`  | `!B + П`          |
| `0110`  | `A + П`           |
| `0111`  | `!A + П`          |
| `1000`  | `A и B`           |
| `1001`  | `A искл_или B`    |
| `1010`  | `!(A искл_или B)` |
| `1011`  | `!A и B`          |
| `1100`  | `A и !B`          |
| `1101`  | `A или !B`        |
| `1110`  | `!A или B`        |
| `1111`  | `A или B`         |

Если микроинструкция проверяет состояние входа `П`, необходимо указать либо `(П=0)`, либо `(П=1)` сразу после мнемоники. В противном случае программа выдаст синтаксическую ошибку об отсутствующем значении `П`.

Ниже приведены примеры, иллюстрирующие синтаксис микроинструкций К584ВМ1:

```
    РОН0 := ШИНвх

    // Вы также можете использовать "=" вместо ":="
    РОН1 = ШИНвх

    // Здесь нужно указать "(П=0)"
    РР := РОН0 + П (П=0)

    // Вы можете использовать "ШВх" и "ШВых" вместо "ШИНвх" и "ШИНвых" для краткости
    ШВых := ШВх

    РРР := ШИНвх и РР
```

Вы можете писать операнды арифметических и логических выражений в любом порядке. Например, следующие микроинструкции эквивалентны:

```
    ШИНвых := ШИНвх - РР - 1 + П (П=0)
    ШИНвых := ШИНвх - РР + П - 1 (П=0)
    ШИНвых := ШИНвх - 1 + П - РР (П=0)
    ШИНвых := -РР + ШИНвх - 1 + П (П=0)
```

Однако при открытии скомпилированного файла `.x584` в симуляторе X584 операнды будут отображаться в стандартном порядке, показанном в таблице микроинструкций выше.

Вы также можете опустить `П` в мнемонике микроинструкции, заменив его на литералы 0 или 1 и при желании упростив получившееся выражение. В этом случае нет необходимости указывать `(П=0)` или `(П=1)` после мнемоники. В таблице ниже приведены несколько примеров микроинструкций, где `П` либо указано явно, либо опущено:

| `П` указано явно                     | `П` опущено                                                    |
| ------------------------------------ | -------------------------------------------------------------- |
| `ШИНвых := !П (П=0)`                 | `ШИНвых := !0`                                                 |
| `ШИНвых := !П (П=1)`                 | `ШИНвых := !1`,<br/>`ШИНвых := 0`                              |
| `ШИНвых := РР + П (П=0)`             | `ШИНвых := РР + 0`,<br/>`ШИНвых := РР`                         |
| `ШИНвых := РР + П (П=1)`             | `ШИНвых := РР + 1`                                             |
| `ШИНвых := ШИНвх - РР - 1 + П (П=0)` | `ШИНвых := ШИНвх - РР - 1 + 0`,<br/>`ШИНвых := ШИНвх - РР - 1` |
| `ШИНвых := ШИНвх - РР - 1 + П (П=1)` | `ШИНвых := ШИНвх - РР - 1 + 1`,<br/>`ШИНвых := ШИНвх - РР`     |

X584 всегда отображает микроинструкции в стандартном виде с явным указанием `П`.

### Метки

В начале любого оператора можно поставить необязательную метку. Метка должна начинаться с буквы или символа подчеркивания, содержать только буквы, цифры или символы подчеркивания и заканчиваться двоеточием. Во время компиляции asm584 присваивает каждой метке числовой адрес текущей микроинструкции. Затем вы можете использовать метки вместо адресов в управляющих операторах `если` или `иди_на`, как показано ниже:

```
начало:
    РР := РР + П (П=1)
    если П то конец
    ШИНвых := РР + П (П=0)
    иди_на начало

конец:
    НОП
```

### Точки останова

Вы можете добавить ключевое слово `останов` перед любой микроинструкцией. Это позволяет устанавливать точки останова непосредственно в ассемблерном коде, а не щелкать мышью по боковой панели в X584. Например:

```
    останов ШИНвых := РОН0
```

### Управляющие операторы

Управляющие операторы - это специальная возможность симулятора X584. Они позволяют анализировать определенные выходы микропроцессора К584ВМ1, изменять значение счетчика команд и т.д. Сам К584ВМ1 не поддерживает управляющие операторы. Предполагается, что они выполняются внешними блоками, такими как микросхема К584ВУ1.

Каждая микроинструкция может иметь только один необязательный управляющий оператор. Он должен располагаться после микроинструкции или комментария X584.

asm584 поддерживает следующие управляющие операторы:

1. **Условный оператор** в виде `если <условие> то <метка или адрес> [иначе <метка или адрес>]`.

   Условие - это имя одного из выходов К584ВМ1, перечисленных в таблице ниже. У некоторых выходов также есть альтернативное имя. Вы можете использовать его для краткости.

   | Выход   | Альтернативное имя |
   | ------- | ------------------ |
   | `ПАЛУ3` | `П`                |
   | `ПАЛУ2` | `П2`               |
   | `ПАЛУ1` | `П1`               |
   | `ПАЛУ0` | `П0`               |
   | `!СДП1` |                    |
   | `!СДЛ1` |                    |
   | `!СДП2` |                    |
   | `!СДЛ2` |                    |
   | `РРР0`  |                    |
   | `РРР3`  |                    |
   | `A15`   |                    |
   | `B15`   |                    |

   Примеры:

   ```
       РР := !РОН0 + П (П=1) если ПАЛУ3 то ноль иначе не_ноль
       РР := !РОН1 + П (П=1) если П то ноль

       // Вы также можете использовать числовые адреса, хотя это не рекомендуется
       РР := !РОН0 + П (П=1) если ПАЛУ3 то 4 иначе 5

       // Управляющий оператор можно перенести на следующую строку для улучшения читаемости
       РР := САЛ(РР + П) (П=0)
       если !СДЛ1 то ноль

   ноль:
       ШИНвых := !П (П=1)
   не_ноль:
       ШИНвых := !П (П=0)
   ```

2. **Оператор безусловного перехода** в виде `иди_на <метка или адрес>`.

   Примеры:

   ```
       ШИНвых := РОН0 иди_на конец

       // Вы также можете использовать числовые адреса, хотя это не рекомендуется
       ШИНвых := РОН0 иди_на 3

       // Управляющий оператор можно перенести на следующую строку для улучшения читаемости
       ШИНвых := РОН0
       иди_на конец

   конец:
       НОП
   ```

3. **Оператор ввода** в виде `ввод <число>`.

   Если вы не хотите вводить значение `ШИНвх` каждый раз при запуске программы, вы можете указать его напрямую в ассемблерном коде с помощью управляющего оператора `ввод`. Он принимает 16-разрядное число в одном из следующих форматов:

   - 16-разрядное двоичное число.
   - Двоичное число, разбитое на 4 группы по 4 цифры, разделенные пробелами.
   - Шестнадцатиричное число в диапазоне [0x0000, 0xFFFF].
   - Десятичное число в диапазоне [-32768, 65535].

   Примеры:

   ```
       РОН0 := ШИНвх ввод 0000000100100011
       РОН1 := ШИНвх ввод 0000 0001 0010 0011
       РОН2 := ШИНвх ввод 0x1234
       РОН3 := ШИНвх ввод 4660
       РОН4 := ШИНвх ввод -1234
   ```

### Комментарии

asm584 поддерживает три типа комментариев:

1. **Многострочный комментарий**, который начинается с `/*` и заканчивается на `*/`. Любой текст между `/*` и `*/` игнорируется ассемблером и не сохраняется в файл `.x584`. Многострочные комментарии можно писать в любом месте исходного кода. Используйте их для больших блоков текста, таких как заголовки файлов или описания алгоритмов:

   ```
   /*
    * Автор: Иванов Иван
    * Описание: Вычисление максимального значения из двух 16-разрядных беззнаковых целых чисел
    */
   ```

2. **Однострочный комментарий**, который начинается с `//`. Любой текст между `//` и концом строки игнорируется ассемблером и не сохраняется в файл `.x584`. Как и многострочные комментарии, однострочные комментарии можно писать в любом месте исходного кода. Используйте их для пояснения блоков кода, например:

   ```
       // Создание битовой маски 1000...000 для знакового разряда
       РР := !П (П=1)
       РР := РР + П (П=1)
       РР := СЦП(РР + П) (П=0)
   ```

3. **Комментарий X584**, который начинается с символа `;` или `#`. Любой текст между `;` или `#` и концом строки будет сохранен в файл `.x584` и отображен в колонке "Комментарий" в X584. Каждая микроинструкция может иметь только один необязательный комментарий X584. Он должен располагаться либо после микроинструкции, либо после управляющего оператора. Используйте комментарии X584 для объяснения смысла отдельных микроинструкций, например:

   ```
       РОН0 := ШИНвх ; Ввод A
       РОН1 := ШИНвх ; Ввод B

       РР := !РОН0 + П (П=1) если П то ноль # Проверка A на ноль

       РР := !РОН1 + П (П=1) # Проверка B на ноль
       если П то ноль

   ноль:
       ШИНвых := !П (П=1)
   ```
